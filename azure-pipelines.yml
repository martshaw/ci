trigger:

  - master

jobs:
  - job: "Linux"
    pool:
      vmImage: "ubuntu-16.04"

    steps:
      - checkout: self
        persistCredentials: true
        clean: true
      - task: NodeTool@0
        inputs:
          versionSpec: "12.x"
        displayName: "Install Node.js"
      - script: |
            ls
      - task: Npm@1
        inputs:
          command: 'install'
          workingDir: '$(Build.SourcesDirectory)'
        displayName: "Npm Install"
      - task: Npm@1
        inputs:
          command: 'custom'
          workingDir: '$(Build.SourcesDirectory)'
          customCommand: 'run build'
        displayName: "Npm InstalBuildl"
      - task: DockerCompose@0
        inputs:
          containerregistrytype: 'Container Registry'
          dockerRegistryEndpoint: 'Docker'
          dockerComposeFile: '**/docker-compose.yml'
          action: 'Run a Docker Compose command'
          dockerComposeCommand: 'up'
          arguments: '--scale nextjs=3 -d'
      - task: Docker@2
        inputs:
          containerRegistry: 'Docker'
          repository: 'ci'
          command: 'buildAndPush'
          Dockerfile: '**/Dockerfile'
          tags: 'lastest'
          addPipelineData: false

